<!DOCTYPE html>
<html>
  <head>
    <title>Processing.js Example Page</title>
    <meta charset="UTF-8">
    <script type="text/javascript" src="processing-1.3.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>

  <body>
    
    <script type="text/processing">
      //  Processing.js example sketch
      int fontsize = 24;
      int h=100;
      int scale=0;
      int w=5;
      int s=100;
      float[] speed = new float[s];
      
      void pushData(data) {

        for(int i=1;i<s;i++) {
            speed[i-1]=speed[i];
        }
        speed[i-1]=data;
        m=0;
        for(int i=0;i<s;i++) {
            if (m<speed[i]) {
            	m = speed[i];
            }
        }
        m = m*1.3;
        if(m==0) {
        	scale=1;
        } else {
        	scale = h/m;
        	scale=min(scale,10)
        	scale=max(scale,0.5)
        }
		
      }
      
      
      void setup() {
        size(w*s, h);
        stroke(0,0,255);
        fill(0);
        for(int i=0;i<s;i++) {
            speed[i]=0.0;
        }
      }

      void draw() {
        background(0);
      	fill(60,60,255);
        stroke(0);
        for(int i=0;i<s;i++) {
            rect(i*w,height-speed[i]*scale,w,speed[i]*scale);
        }

        stroke(255,0,0);
        /*var i=0;
        while(i<height) {
        	line(0,i,width,i);        	
        	i+=w;
        }*/
        line(0,10*scale,width,10*scale);
        
      }
    </script>
    <canvas id="graph" style="border: 1px solid black;"></canvas>
    <script>

     var socket = io.connect('http://localhost:3000');
	  socket.on('stats', function (data) {
	  	p = Processing.getInstanceById('graph');
	  	console.debug(data.write);
    	p.pushData(data.write);
	  });
    
    
    </script>
  </body>
</html>
